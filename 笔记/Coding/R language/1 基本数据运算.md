
# Vector类型
笼统而言分为：
+ 数字
+ 文字
```R
> weight <- 1:10
> name <- c("hello", "r", "language")

#可以使用str()函数来判断类型

> str(weight)
 int [1:10] 1 2 3 4 5 6 7 8 9 10
> str(name)
 chr [1:3] "hello" "r" "language"
```

Output为
+ **int, dbl, num: vector**属于数字类型，可以互相加减乘除;
+ **chr, fct, ord: vector**属于文字类型，不能加减乘除。

## 数字类型
```R

#计算中位数，最小值，最大值，方差（variance），标准差（standard deviation），四分位距（IQR），值域
> median(weight)
[1] 5.5

> min(weight)
[1] 1

> max(weight)
[1] 10

> var(weight)
[1] 9.166667

> sd(weight)
[1] 3.02765

> IQR(weight)
[1] 4.5
  
> range(weight)
[1]  1 10

#使用summary()函数可以方便的显示多项
> summary(weight)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1.00    3.25    5.50    5.50    7.75   10.00 
```

length函数来输出向量中的元素个数
```R
length(weight)
[1] 10
```

### 数学概念

#### 标准差 (Standard deviation)  
缩写 SD，符号 σ；作为测量一组数值的离散程度之用。（即为方差开算术平方根）； ^591212
$$
S=\sqrt{\sum (x_i-\bar x)^2 \over N}
$$
#### 标准误（Standard error）
标准误 SE 用于预测样本数据准确性，标准误越小，样本均值和总体均值差距越小，样本数据越能代表总体数据。
$$SE = \sqrt{\frac{s^{2}}{n}}$$


#### 四分位距（Interquartile range, IQR ）
与方差、标准差一样，表示统计资料中各变量分散情形，但四分差更多为一种稳健统计；
$$
IQR = Q_{3}- Q_1
$$
Q1为下四分位数，Q3为上四分位数；Q2（中位数）

四分位数暂有两种求法，暂且不谈，按R语言计算方法来

*此外四分位数可用于箱线图绘制：*

![[../../assets/Coding/boxplot.jpg|350]]
可由函数
boxplot(name) / boxplot(name ,horizontal = T) 绘制
详见
[R 语言— 箱线图](https://blog.csdn.net/qq_40794743/article/details/107941610)
[R 语言 boxplot 函数](http://www.codebaoku.com/it-r/it-r-207827.html)

### Dataframe

^f21e27

由于Dataframe中每一列都是一个vector，所以也可以用于计算
```R
summary(iris$Sepal.Length)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  4.300   5.100   5.800   5.843   6.400   7.900
```

## “文字”类型
文字类型的vector中，element一般代表类别，我们可以做数数的处理。比如性别是一个vector，长度为100。我们就可以数一下，其中有多少位女同学，多少位男同学。
对于iris 这个DF，iris$Species 这一列长度为150，对其种类名计数：
```R
table(iris$Species)

 setosa versicolor  virginica 
    50         50         50 

```


# 批量式计算

> **apply() 而不是Loop**

## Apply

基本格式：

```
apply(X, MARGIN, FUN, ...)
```

参数：
X: 数组、矩阵、DF
MARGIN: 按行计算或按按列计算，1 表示按行，2 表示按列
FUN: 自定义的调用函数
… : 更多参数，可选

```R
vec <- 1:15
mat1 <- matrix(vec, nrow=3)
apply1 <- apply(mat1, 1, sum)
[1] 35 40 45

apply2 <- apply(mat1, 1, sqrt)
print(apply2)
         [,1]     [,2]     [,3]
[1,] 1.000000 1.414214 1.732051
[2,] 2.000000 2.236068 2.449490
[3,] 2.645751 2.828427 3.000000
[4,] 3.162278 3.316625 3.464102
[5,] 3.605551 3.741657 3.872983

apply3 <- apply(mat1, 2, sqrt)
print(apply3)
         [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 1.000000 2.000000 2.645751 3.162278 3.605551
[2,] 1.414214 2.236068 2.828427 3.316625 3.741657
[3,] 1.732051 2.449490 3.000000 3.464102 3.872983

#可用函数round (x, n)来设定保留的小数位
```

## Map

purrr 包中的函数，有三类：
-   map 函数，支持一元函数 
-   map2 函数，支持二元函数 
-   pmap 函数，支持多元函数

逻辑如下：   
![[../../assets/Coding/map.png|450]]

```R
library(purrr)
dat = data.frame(y1 = rnorm(10),y2 = rnorm(10)+10)
map(dat,mean)

##
$y1
[1] -0.4687846

$y2
[1] 9.9806

map_df(dat,mean) # 转化为数据框

# A tibble: 1 × 2
      y1    y2
   <dbl> <dbl>
1 -0.469  9.98

```


# 自定义函数

创建函数的语法如下：
```R
function_name <- function(argument1, argument2, ...){
  对参数1和参数2
  进行
  一系列
  一行或者多行
  计算
  return(result)
}
```
这里，function () 是一个内置的 R 函数，其功能就是创建函数。

如，编写一个计算标准误（standard error）的方程：
```R
SE <- function(x) {
  s <- sd(x)
  n <- length(x)
  result <- s/sqrt(n)
  return(result)
}
```

创建后的调用为
```R
function(argument1 = value1, argument2 = value2, ...)

# 即
SE(c(5,6,5,5,4,5,6,6,5,4,5,3,8))

#> [1] 0.337
```

## 匿名函数

顾名思义，即函数未分配名称也可以执行。一般，会与 `apply` 族函数、`map`函数等联用。

```R
sapply(1:5, function(x) x^2) # sapply类似于apply，但会输出最化简的结果

#> [1]  1  4  9 16 25
```

另一种匿名函数是Lambda 函数，即 Lambda 表达式 (lambda expression)，Lambda 表达式基于数学中的 λ 演算得名，直接对应于其中的 lambda 抽象 (lambda abstraction)。
```python
foo = [2, 18, 9, 22, 17, 24, 8, 12, 27]

print map(lambda x: x * 2 + 10, foo) # 此处为标准包map，见advanced py
[14, 46, 28, 54, 44, 58, 26, 34, 64]
```


### * 一元map函数

有三种等价：
-   第一种，是直接调用非匿名函数，不需要～符号，默认是对列处理，如果对行处理，可以用 `pmap`
-   第二种，是调用匿名函数，前面需要用～，参数用`.x`
-   第三种，是调用匿名函数，前面需要用～，参数用`..1`

```
map(dat,max)
map(dat,~max(.x))
map(dat,~max(..1))
```

```R
map(dat,~mean(.x,na.rm = T)) # 使用了匿名函数，可以把匿名函数的参数，写在里面
$x1
[1] -0.1100182

$x2
[1] -0.2338953

$x3
[1] -0.3660053

$x4
[1] 0.02137338
```
