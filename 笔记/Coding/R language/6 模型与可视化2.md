# çº¿æ€§å›å½’æ¨¡å‹è¯Šæ–­

## æ£€æŸ¥æ¨¡å‹æ˜¯å¦å¯é 
çº¿æ€§å›å½’çš„ **LINE** å‡è®¾:
![[../../assets/Coding/LINE.png|450]]

Shown in one picture will be like:
![[../../assets/Coding/LINE_illustrated.png|500]]

## è¯¯å·®
ç”±äºè¯¯å·®è¦ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œå®é™…ä¸­ä½¿ç”¨æ®‹å·®æ¥ä¼°è®¡è¯¯å·®å¹¶æ£€éªŒï¼
$${\hat \varepsilon _i} = {\hat y_i} - {y_i}$$
å³ï¼š
1. å‡å€¼ä¸º0 - æ®‹å·®å‡åŒ€åˆ†å¸ƒåœ¨0çš„ä¸¤ä¾§
2. æ­£æ€åˆ†å¸ƒ - qqplot
3. åŒåˆ†å¸ƒï¼ˆæ–¹å·®ç›¸åŒï¼‰
4. ~~ç‹¬ç«‹æ€§ï¼ˆä½†ä¸€èˆ¬ä¸æ£€éªŒï¼‰~~

## Rå¯è§†åŒ–æ£€éªŒ

```R
mod <- lm(formula = mpg ~ wt, data = mtcars)
# par(mfrow=c(2,2))  å››å¼ å›¾åŒæ—¶ä»¥2x2æ˜¾ç¤º
plot(mod)
```

### æ®‹å·®å›¾ï¼š
![[../../assets/Data Analysis/plot_1.png|400]]
å‡å€¼ä¸º0çš„å›¾ï¼Œå°½é‡æ‹Ÿåˆä¸­é—´çš„è™šçº¿ï¼›   
æ–¹å·®ç›¸åŒçš„å›¾ï¼Œç‚¹åˆ†å¸ƒå®½åº¦ç›¸ä¼¼ï¼›
å¯¹äºæ­¤å›¾ï¼Œå¯ä»¥è¡¨æ˜å¯¹äº15-25çš„èŒƒå›´å†…ï¼Œè¯¯å·®åˆ†å¸ƒæ¯”è¾ƒå¥½ã€‚

### QQplot 
![[../../assets/Data Analysis/plot_2.png|400]]
æ•°æ®æ­£æ€çš„å›¾ï¼Œç‚¹åˆ†å¸ƒåœ¨è™šçº¿ç›´çº¿ä¸Šï¼›
å¯¹äºæ­¤å›¾ï¼Œåœ¨ (-1,1)ä¸Šï¼Œåˆ†å¸ƒæ¯”è¾ƒç¬¦åˆ

æˆ–ç”¨`shapiro.test(mod$residuals)`
```
Shapiro-Wilk normality test

data:  mod$residuals
W = 0.94508, p-value = 0.1044  # > 0.05!!
```

## æ¨¡å‹æœ‰è¯¯çš„å¤„ç†
1. æ£€æŸ¥çº¿æ€§å‹æ˜¯å¦æœ‰è¯¯ï¼Œå¹¶è€ƒè™‘å¯¹å˜é‡åšå˜æ¢ï¼ˆå¾ˆå¤šéçº¿æ€§æ¨¡å‹éƒ½å¯ä»¥é€šè¿‡å˜æ¢è½¬åŒ–ä¸ºçº¿æ€§æ¨¡å‹ï¼‰
$$
\begin{gathered}
  y = k{e^{ax}} \Leftrightarrow \log y = ax + \log k \hfill \\
  y = {x^k} \Leftrightarrow \log y = k\log x \hfill \\ 
\end{gathered} 
$$
2. æ£€æŸ¥æ˜¯å¦æœ‰ç¦»ç¾¤å€¼å½±å“å› å­å¾ˆå¤§çš„æ•°æ®ç‚¹ï¼Œè€ƒè™‘å‰”é™¤ï¼ˆ<font color="#ff0000">è°¨æ…</font>ï¼Œè¾“é”™è¿˜æ˜¯æ•°æ®æœ¬èº«å¼‚å¸¸ï¼Ÿï¼‰ï¼›ç®€å•çº¿æ€§å›å½’è¯·ç”»å›¾æ£€éªŒ
3. å¤šå…ƒçº¿æ€§? - ä½¿ç”¨Leverage score (Hat values) æˆ–è€…Cook's diatance


# å¹¿ä¹‰çº¿æ€§æ¨¡å‹ - Generalized linear model

**â€œå¹¿ä¹‰â€** ä¸€è¯æŒ‡çš„æ˜¯å“åº”å˜é‡çš„éæ­£æ€åˆ†å¸ƒï¼Œæ¢è¨€ä¹‹ï¼Œå¹¿ä¹‰æ¨¡å‹åŒ…å«äº†éæ­£æ€å› å˜é‡ï¼š
+ ç»“æœå˜é‡ï¼ˆå› å˜é‡ï¼‰ä¸ºç±»åˆ«å‹ï¼šåŒ…æ‹¬äºŒå€¼å˜é‡ï¼ˆæ˜¯ / å¦ã€é€šè¿‡ / å¤±è´¥ã€å­˜æ´» / æ­»äº¡ï¼‰å’Œå¤šç±»åˆ«å˜é‡ï¼ˆä¼˜ / è‰¯ / å¯ / å·®ï¼‰ç­‰ã€‚
-  ç»“æœå˜é‡ä¸ºè®¡æ•°å‹çš„ï¼ˆä¸€å‘¨äº¤é€šäº‹æ•…çš„æ•°ç›®ã€æ¯æ—¥é…’æ°´æ¶ˆè€—çš„æ•°é‡ï¼‰ï¼Œè¿™ç±»å˜é‡éƒ½æ˜¯éè´Ÿçš„æœ‰é™å€¼ï¼Œå®ƒä»¬çš„å‡å€¼å’Œæ–¹å·®é€šå¸¸éƒ½æ˜¯ç›¸å…³çš„ï¼ˆè€Œæ­£æ€åˆ†å¸ƒå˜é‡é—´åˆ™æ˜¯ç›¸äº’ç‹¬ç«‹ï¼‰

## In R

ä½¿ç”¨ `glm ()` å‡½æ•°æ„å»ºå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼š
```R
glm(
  formula, 
  family=family(link=function), 
  data=data
)
```

ä¸€äº›å¸¸ç”¨å®¶æ—:
1. family=binomial(link="logit") --- Response variable for two values (0 and 1)
$$log_{e}(\frac{\pi}{1-\pi}) = \beta_0 + \sum_{j=1}^{p}\beta_{j}X_{j}$$
2. family=poisson(link="log") ---- A situation in which the response variable is the number of events that occur within a given time
$$log_{e}(\lambda) = \beta_0 + \sum_{j=1}^{p}\beta_{j}X_{j}$$
3. family=gaussian(link="identity") ---- Standard linear regression, a special case of generalized linear regression
$$\mu_{Y} = \beta_0 + \sum_{j=1}^{p}\beta_{j}X_{j}$$

```R
modlogit = glm(am ~ wt, family = binomial, data = mtcars)
plot(x = mtcars$wt, y = modlogit$fitted.values)
```
![[../../assets/Data Analysis/logit.png|400]]
å¯ä»¥å‘ç°ï¼Œyè½´è¡¨ç¤ºäº†æ¦‚ç‡ï¼Œè½¦é‡ä¸º3å·¦å³æ—¶ï¼Œ0.5çš„å¯èƒ½æ˜¯æ˜¯æ‰‹åŠ¨æŒ¡ã€‚

## ğŸ§çš„æ•°æ®ï¼ˆfrom packageï¼‰
```R
library(palmerpenguins) 
data(penguins)
head(penguins)
---
# A tibble: 6 Ã— 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
  <fct>   <fct>              <dbl>         <dbl>             <int>       <int> <fct>  <int>
1 Adelie  Torgersen           39.1          18.7               181        3750 male    2007
2 Adelie  Torgersen           39.5          17.4               186        3800 female  2007
3 Adelie  Torgersen           40.3          18                 195        3250 female  2007
4 Adelie  Torgersen           NA            NA                  NA          NA NA      2007
5 Adelie  Torgersen           36.7          19.3               193        3450 female  2007
6 Adelie  Torgersen           39.3          20.6               190        3650 male    2007
```

ç»˜boxå›¾ï¼š
```R
penguins %>%
  ggplot(aes(x = species, y = flipper_length_mm)) +
  
  # outlierä¸ºå¼‚å¸¸å€¼ï¼Œå¯ä»¥è®¾å®šå½¢çŠ¶ä¸é¢œè‰²
  geom_boxplot(aes(col = species), outlier.colour="red", outlier.shape=8) +
  
  # è®¾ç½®æ•°æ®æŠ–åŠ¨
  geom_jitter(aes(col = species), alpha = 0.5, shape=16, position = position_jitter(0.3)) +
  
  # stat_summary, å¯ä»¥ç”¨äºæ·»åŠ å‡å€¼ç‚¹
  stat_summary(fun="mean", geom="point", shape=10, size=6, color="black") +
  theme_minimal()
```
![[../../assets/Data Analysis/glm1.png|500]]
å¯è§ä¸‰ç»„æ•°æ®ä¹‹é—´æœ‰æ˜¾è‘—æ€§å·®å¼‚ã€‚
> ä½•ä¸ºæ˜¾è‘—æ€§å·®å¼‚ï¼Ÿæ•°æ®ä¹‹é—´å…·**æœ‰äº†æ˜¾è‘—æ€§å·®å¼‚**ï¼Œå°±è¯´æ˜å‚ä¸æ¯”å¯¹çš„æ•°æ®**ä¸æ˜¯**æ¥è‡ªäº**åŒä¸€æ€»ä½“**ï¼ˆPopulationï¼‰ï¼Œè€Œæ˜¯æ¥è‡ªäºå…·æœ‰å·®å¼‚çš„ä¸¤ä¸ªä¸åŒæ€»ä½“ã€‚

ç”±äºæ˜¯æ­£æ€åˆ†å¸ƒï¼Œé‡‡ç”¨ä¸Šè¿°ç¬¬ä¸‰ç§ï¼Œå³ç‰¹æ®ŠåŒ–GLMâ€”â€”æˆ–è€…ç§°ä¸€èˆ¬çš„LMï¼š
```R
mod_flipper <- glm(flipper_length_mm ~ species,
            ##specify the data
            data = penguins,
            ##specify the error structure
            family = "gaussian")
summary(mod_flipper)
---
Call:
glm(formula = flipper_length_mm ~ species, family = "gaussian", 
    data = penguins)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-17.9536   -4.8235    0.0464    4.8130   20.0464  

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)      189.9536     0.5405 351.454  < 2e-16 ***
speciesChinstrap   5.8699     0.9699   6.052 3.79e-09 ***
speciesGentoo     27.2333     0.8067  33.760  < 2e-16 ***

Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

(Dispersion parameter for gaussian family taken to be 44.1099)

    Null deviance: 67427  on 341  degrees of freedom
Residual deviance: 14953  on 339  degrees of freedom
  (2 observations deleted due to missingness)
AIC: 2270.6

Number of Fisher Scoring iterations: 2
```

### å¤šé‡æ¯”è¾ƒæ£€éªŒ
multcompåŒ…æä¾›äº†æ–¹æ³•ï¼š
```R
library(multcomp)

# ### Tukey HSDæ£€éªŒï¼Œè¯¥åŒ…è¿˜å¯ä»¥å®ç°Dunnettæ–¹æ³•
T <- glht(mod_flipper, mcp(species="Tukey"))
summary(T)
---
	 Simultaneous Tests for General Linear Hypotheses

Multiple Comparisons of Means: Tukey Contrasts

Fit: glm(formula = flipper_length_mm ~ species, family = "gaussian", 
    data = penguins)

Linear Hypotheses:
                        Estimate Std. Error z value Pr(>|z|)    
Chinstrap - Adelie == 0   5.8699     0.9699   6.052 2.63e-09 ***
Gentoo - Adelie == 0     27.2333     0.8067  33.760  < 1e-09 ***
Gentoo - Chinstrap == 0  21.3635     1.0036  21.286  < 1e-09 ***

Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
(Adjusted p values reported -- single-step method)


par(mar=c(4,8,3,3)) # plotæ˜¾ç¤ºä¸å®Œå…¨ï¼Œè®¾ç½®è¾¹ç¼˜ç©ºç™½å¤§å°ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºå·¦å³å®½
plot(T)
```
![[../../assets/Data Analysis/glm2.png|500]]


## âš¾çš„æ•°æ®ï¼ˆå®éªŒï¼‰
```R
ball <- vroom("https://raw.githubusercontent.com/Cafwell/Bioinformatics_data/master/IBT/all_groups_data.csv")

levels(as.factor(ball$Species))
---
[1] "dark pink"  "darkblue"  "darkgreen"  "darkpink"  "green"  "lightblue" 
[7] "lightgreen" "lightpink" "orange"     "purple"    "red"    "teal"      
[13] "yellow" 
```

æ•´ç†ï¼š
```R
ball$Species[which(ball$Species == "dark pink")] <- "darkpink"
ball$Species[which(ball$Species == "dark green")] <- "teal"
ball$Species[which(ball$Species == "light green")] <- "green"
levels(as.factor(ball$Species))
---
[1] "darkblue"  "darkpink"  "green"     "lightblue" "lightpink" "orange"   
[7] "purple"    "red"       "teal"      "yellow" 
```

```R
grouped_1 <- ball %>%
  group_by(Group_name,
           Bucket,
           Distance) %>%
  filter(Success == 1) %>%
  summarise(Count = n())
head(grouped_1)
---
# A tibble: 6 Ã— 4
# Groups:   Group_name, Bucket [4]
  Group_name      Bucket Distance Count
  <chr>            <dbl>    <dbl> <int>
1 Albert Lukatima      1      0.5    10
2 Albert Lukatima      1      1.5     3
3 Albert Lukatima      5      2       5
4 Albert Lukatima      5      2.5     3
5 BY                   1      1       7
6 BY                   5      0.5    12
```